"use strict";(self.webpackChunkhpcdocs=self.webpackChunkhpcdocs||[]).push([[207],{3905:(n,e,a)=>{a.d(e,{Zo:()=>m,kt:()=>_});var i=a(7294);function r(n,e,a){return e in n?Object.defineProperty(n,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[e]=a,n}function t(n,e){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),a.push.apply(a,i)}return a}function l(n){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?t(Object(a),!0).forEach((function(e){r(n,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(a,e))}))}return n}function s(n,e){if(null==n)return{};var a,i,r=function(n,e){if(null==n)return{};var a,i,r={},t=Object.keys(n);for(i=0;i<t.length;i++)a=t[i],e.indexOf(a)>=0||(r[a]=n[a]);return r}(n,e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(n);for(i=0;i<t.length;i++)a=t[i],e.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(n,a)&&(r[a]=n[a])}return r}var u=i.createContext({}),o=function(n){var e=i.useContext(u),a=e;return n&&(a="function"==typeof n?n(e):l(l({},e),n)),a},m=function(n){var e=o(n.components);return i.createElement(u.Provider,{value:e},n.children)},g="mdxType",p={inlineCode:"code",wrapper:function(n){var e=n.children;return i.createElement(i.Fragment,{},e)}},k=i.forwardRef((function(n,e){var a=n.components,r=n.mdxType,t=n.originalType,u=n.parentName,m=s(n,["components","mdxType","originalType","parentName"]),g=o(a),k=r,_=g["".concat(u,".").concat(k)]||g[k]||p[k]||t;return a?i.createElement(_,l(l({ref:e},m),{},{components:a})):i.createElement(_,l({ref:e},m))}));function _(n,e){var a=arguments,r=e&&e.mdxType;if("string"==typeof n||r){var t=a.length,l=new Array(t);l[0]=k;var s={};for(var u in e)hasOwnProperty.call(e,u)&&(s[u]=e[u]);s.originalType=n,s[g]="string"==typeof n?n:r,l[1]=s;for(var o=2;o<t;o++)l[o]=a[o];return i.createElement.apply(null,l)}return i.createElement.apply(null,a)}k.displayName="MDXCreateElement"},3563:(n,e,a)=>{a.r(e),a.d(e,{assets:()=>u,contentTitle:()=>l,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>o});var i=a(7462),r=(a(7294),a(3905));const t={slug:"singularity"},l="Singularity",s={unversionedId:"compiling/singularity",id:"compiling/singularity",title:"Singularity",description:"Einstaka hugb\xfana\xf0ur mun virka betur \xed \xf6\xf0rum umhverfm, til d\xe6mis AlphaFold",source:"@site/i18n/is/docusaurus-plugin-content-docs/current/compiling/08_singularity.md",sourceDirName:"compiling",slug:"/compiling/singularity",permalink:"/is/docs/compiling/singularity",draft:!1,editUrl:"https://github.com/irhpc/irhpc.github.io/edit/main/docs/compiling/08_singularity.md",tags:[],version:"current",sidebarPosition:8,frontMatter:{slug:"singularity"},sidebar:"tutorialSidebar",previous:{title:"TensorFlow",permalink:"/is/docs/compiling/TensorFlow-GPU"},next:{title:"MatLab",permalink:"/is/docs/compiling/matlab"}},u={},o=[{value:"Hvad er Singularity?",id:"hvad-er-singularity",level:2},{value:"Singularity grunnnotkun",id:"singularity-grunnnotkun",level:2},{value:"A\xf0 s\xe6kja myndir",id:"a\xf0-s\xe6kja-myndir",level:3},{value:"Samskipti vi\xf0 myndir",id:"samskipti-vi\xf0-myndir",level:3},{value:"Framkv\xe6ma skipanir",id:"framkv\xe6ma-skipanir",level:3},{value:"A\xf0 keyra g\xe1minn",id:"a\xf0-keyra-g\xe1minn",level:3},{value:"Vinna me\xf0 skr\xe1r",id:"vinna-me\xf0-skr\xe1r",level:2},{value:"A\xf0 sm\xed\xf0a \xfeinn egin g\xe1m",id:"a\xf0-sm\xed\xf0a-\xfeinn-egin-g\xe1m",level:2},{value:"F\xe6ra g\xe1m yfir \xe1 Elju",id:"f\xe6ra-g\xe1m-yfir-\xe1-elju",level:4},{value:"Keyra Singularity me\xf0 SLURM",id:"keyra-singularity-me\xf0-slurm",level:2},{value:"GPU D\xe6mi",id:"gpu-d\xe6mi",level:3},{value:"Singularity g\xe1mar og SLURM verkefni",id:"singularity-g\xe1mar-og-slurm-verkefni",level:3}],m={toc:o},g="wrapper";function p(n){let{components:e,...a}=n;return(0,r.kt)(g,(0,i.Z)({},m,a,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"singularity"},"Singularity"),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Einstaka hugb\xfana\xf0ur mun virka betur \xed \xf6\xf0rum umhverfm, til d\xe6mis ",(0,r.kt)("a",{parentName:"p",href:"AlphaFold"},"AlphaFold"))),(0,r.kt)("h2",{id:"hvad-er-singularity"},"Hvad er Singularity?"),(0,r.kt)("p",null,"Singularity er g\xe1mapallur, svipa\xf0 og Docker. \xdea\xf0 gerir notendum okkar kleift a\xf0 b\xfaa til og keyra g\xe1ma \xe1 \xfeann h\xe1tt a\xf0 h\xe6gt s\xe9 a\xf0 afrita \xf6ll hugb\xfana\xf0arstykki pakkans.\nNotendur geta sm\xed\xf0a\xf0 g\xe1m \xe1 heimat\xf6lvunni sinni og s\xed\xf0an keyrt hann \xe1 Elju e\xf0a n\xe1\xf0 \xed umhverfi sem fyrir eru \xfar ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.sylabs.io/library"},"Singularity Library")," e\xf0a ","[Docker Hub]","(",(0,r.kt)("a",{parentName:"p",href:"https://hub."},"https://hub.")," docker.com)"),(0,r.kt)("h2",{id:"singularity-grunnnotkun"},"Singularity grunnnotkun"),(0,r.kt)("p",null,"Singularity b\xfd\xf0ur upp \xe1 g\xe1makerfi l\xedkt og Docker.\nTil a\xf0 nota Singularity \xe1 ",(0,r.kt)("strong",{parentName:"p"},"Elju")," ver\xf0ur \xfe\xfa fyrst a\xf0 hefja gagnvirka lotu:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ srun --job-name "Singularity Job" --partition 48cpu_192mem --time 01:00:00 --pty bash \n')),(0,r.kt)("p",null,"Sj\xe1\xf0u ",(0,r.kt)("a",{parentName:"p",href:"../elja/interactive_session"},"h\xe9r")," til a\xf0 l\xe6ra meira um gagnvirkar lotur."),(0,r.kt)("h3",{id:"a\xf0-s\xe6kja-myndir"},"A\xf0 s\xe6kja myndir"),(0,r.kt)("p",null,"\xdeegar gagnvirk lota er virk getur \xfe\xfa nota\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"singularity")," skipunina:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ singularity --version\nsingularity-ce version 3.11.4-1.el8\n")),(0,r.kt)("p",null,"\xdea\xf0 eru b\xe6\xf0i til innf\xe6ddar Singularity myndir, sem eru \xed bo\xf0i \xe1 Singularity g\xe1ma safninu, skipunin ",(0,r.kt)("inlineCode",{parentName:"p"},"pull")," hle\xf0\xfar ni\xf0ur myndini \xed skr\xe1arkerfi\xf0 \xfeitt."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ singularity pull library://sylabsed/linux/alpine\n")),(0,r.kt)("p",null,"\xde\xfa getur einnig nota\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"pull")," til a\xf0 s\xe6kja Docker myndir fr\xe1 ",(0,r.kt)("a",{parentName:"p",href:"https://hub.docker.com"},"Docker Hub"),", \xed \xfev\xed tilfelli mun ",(0,r.kt)("inlineCode",{parentName:"p"},"pull")," hla\xf0a ni\xf0ur myndinni fr\xe1 Docker og setja \xfea\xf0 saman \xed l\xf6g sem eru s\xed\xf0an samsett \xed noth\xe6fa Singularity skr\xe1."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ singularity pull docker://godlovedc/lolcow\n")),(0,r.kt)("p",null,"A\xf0 s\xe6kja Docker myndir minnkar l\xedkurnar \xe1 a\xf0 h\xe6gt s\xe9 a\xf0 endurgera umhverfi\xf0. Sem d\xe6mi; ef \xfe\xfa s\xe6kir Docker mynd \xed dag og svo aftur eftir sex m\xe1nu\xf0i eru ekki h\xe6gt a\xf0 \xe1byrgjast a\xf0 myndinn s\xe9 s\xfa sama. Ef eitthva\xf0 af grunn l\xf6gunum hefur breyst \xed myndinni mun \xf6ll myndinn vera breytt.\nEf mikil \xe1hersla er l\xf6g\xf0 \xe1 a\xf0 endurgera n\xe1kv\xe6mlega sama umhverfi\xf0 reyndu \xfe\xe1 a\xf0 byggja umhverfi\xf0 \xfeitt fr\xe1 g\xe1masafni Singularity. "),(0,r.kt)("p",null,"\xde\xfa getur einnig nota\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"build")," skipunina til a\xf0 hla\xf0a ni\xf0ur forbygg\xf0um myndum. \xdeegar build er nota\xf0 ver\xf0ur \xfe\xfa a\xf0 gefa g\xe1mnum nafn eins og s\xe9st h\xe9r:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ singularity build ubuntu.sif library://ubuntu\n\n$ singularity build lolcow.sif docker://godlovedc/lolcow\n")),(0,r.kt)("p",null,"\xd3l\xedkt ",(0,r.kt)("inlineCode",{parentName:"p"},"pull")," mun ",(0,r.kt)("inlineCode",{parentName:"p"},"build")," breyta myndinni \xed n\xfdjustu \xfatg\xe1fu af Singularity myndi eftir a\xf0 henni hefur veri\xf0 hla\xf0i\xf0 ni\xf0ur."),(0,r.kt)("h3",{id:"samskipti-vi\xf0-myndir"},"Samskipti vi\xf0 myndir"),(0,r.kt)("p",null,"\xde\xe9 getur nota ",(0,r.kt)("inlineCode",{parentName:"p"},"search")," skipunina til a\xf0 sta\xf0setja h\xf3pa, s\xf6fn og g\xe1ma sem \xfe\xfa hefur \xe1huga \xe1 af ",(0,r.kt)("a",{parentName:"p",href:"https://cloud.sylabs.io/library"},"G\xe1masafninu"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ singularity search metaerg\nFound 1 container images for amd64 matching "metaerg":\n\n        library://rbazile/default/metaerg:1.0.4,amd64,latest\n')),(0,r.kt)("p",null,"Til a\xf0 keyra g\xe1minn getur \xfe\xfa anarsvegar keyrt hann gagnvirkt e\xf0a framkv\xe6mt skipanir \xe1 hann."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ singularity shell lolcow_latest.sif\nSingularity> cowsay This is from a shell\n ______________________\n< This is from a shell >\n ----------------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n\n")),(0,r.kt)("p",null,"Shell virkar l\xedka me\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"library://"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"docker://")," og ",(0,r.kt)("inlineCode",{parentName:"p"},"shub://")," sl\xf3\xf0um. \xdeetta b\xfdr til t\xedmabundinn g\xe1m sem hverfur \xfeegar skelinni hefur veri\xf0 loka\xf0."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"singularity shell library://sylabsed/examples/lolcow\nINFO:    Using cached image\nSingularity> cowsay This container will self destruct when it is exited\n ________________________________________\n/ This container will self destruct when \\\n\\ it is exited                           /\n ----------------------------------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n")),(0,r.kt)("h3",{id:"framkv\xe6ma-skipanir"},"Framkv\xe6ma skipanir"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"exec")," skipunin  leyfir a\xf0 framkv\xe6ma s\xe9rsni\xf0nar skipanir innan g\xe1msins me\xf0 \xfev\xed a\xf0 skilgreina ",(0,r.kt)("inlineCode",{parentName:"p"},".sif")," skr\xe1na. Sem d\xe6mi:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"}," singularity exec lolcow_latest.sif cowsay i am cat\n __________\n< i am cat >\n ----------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"exec")," virkar einnig me\xf0  ",(0,r.kt)("inlineCode",{parentName:"p"},"library://"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"docker://")," og ",(0,r.kt)("inlineCode",{parentName:"p"},"shub://")," sl\xf3\xf0um. \xdeetta b\xfdr til t\xedmabundinn g\xe1m sem ey\xf0ist eftir a\xf0 skipunin hefur veri\xf0 keyr\xf0."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'singularity exec library://sylabsed/examples/lolcow cowsay "THIS CONTAINER WILL BE DESTROYED"\nINFO:    Using cached image\n __________________________________\n< THIS CONTAINER WILL BE DESTROYED >\n ----------------------------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n')),(0,r.kt)("h3",{id:"a\xf0-keyra-g\xe1minn"},"A\xf0 keyra g\xe1minn"),(0,r.kt)("p",null,"Singularity g\xe1mar innihalda ",(0,r.kt)("a",{parentName:"p",href:"https://docs.sylabs.io/guides/3.0/user-guide/definition_files.html#runscript"},"keyrsluskriftur"),". \xdeetta er notendaskilgreind skrifta sem skilgrenir \xfe\xe6r a\xf0ger\xf0ir sem g\xe1mur \xe6tti a\xf0 framkv\xe6ma \xfeegar hann er keyr\xf0ur. \xdeessi skrifta fer \xed gangi me\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"run")," skipuninin, e\xf0a me\xf0 \xfev\xed a\xf0 kalla \xe1 g\xe1min eins og hann v\xe6ri keyranleg skr\xe1."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ singularity run lolcow_latest.sif\n _____________________________________\n/ You have been selected for a secret \\\n\\ mission.                            /\n -------------------------------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n\n$ ./lolcow_latest.sif\n ____________________________________\n/ Q: What is orange and goes "click, \\\n\\ click?" A: A ball point carrot.    /\n ------------------------------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n')),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"run")," virkar einnig me\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"library://")," og ",(0,r.kt)("inlineCode",{parentName:"p"},"docker:///")," sl\xf3\xf0um. \xdeetta b\xfdr til t\xedmabundinn g\xe1m sem ey\xf0ist eftir a\xf0 hann kl\xe1rar."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"singularity run library://sylabsed/examples/lolcow\nINFO:    Using cached image\n ______________________________________\n/ April 1                              \\\n|                                      |\n| This is the day upon which we are    |\n| reminded of what we are on the other |\n| three hundred and sixty-four.        |\n|                                      |\n| -- Mark Twain, \"Pudd'nhead Wilson's  |\n\\ Calendar\"                            /\n --------------------------------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n")),(0,r.kt)("h2",{id:"vinna-me\xf0-skr\xe1r"},"Vinna me\xf0 skr\xe1r"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ echo "Hello from inside the container" > $HOME/hostfile.txt\n\n$ singularity exec lolcow_latest.sif cat $HOME/hostfile.txt\n\nHello from inside the container\n')),(0,r.kt)("p",null,"\xdeetta virkar vegna \xfeess a\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"hostfile.txt")," er til \xe1 heimasv\xe6\xf0i notandans. Singularity festi ",(0,r.kt)("inlineCode",{parentName:"p"},"/home/$USER"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"/tmp")," og ",(0,r.kt)("inlineCode",{parentName:"p"},"$PWD")," inn \xed g\xe1minn vi\xf0 keyrslu."),(0,r.kt)("p",null,"\xde\xfa getur teki\xf0 fram a\xf0rara m\xf6ppur og fest \xfe\xe6r inn \xed \xfeinn g\xe1m me\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"--bind")," skipuninni, til d\xe6min ",(0,r.kt)("inlineCode",{parentName:"p"},"/scratch/$USER/data")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ echo "Do science!" > /scratch/$USER/data/text.txt\n$ singularity exec --bind /scratch/$USER/data:/mnt lolcow_latest.sif cat /mnt/text.text\nDo science!\n')),(0,r.kt)("p",null,"\xcd \xfeessu tilfelli er ",(0,r.kt)("inlineCode",{parentName:"p"},"/scratch/$USER/data")," mappan bundinn vi\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"/mnt")," innann g\xe1msins."),(0,r.kt)("p",null,"P\xedpur og \xe1framsendingar virka l\xedka me\xf0 Singularity skipunninn eins og me\xf0 \xf6\xf0rum Unix skipunum:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cat /scratch/$USER/data/text.txt | singularity exec lolcow_latest.sif cowsay\n _____________\n< Do science! >\n -------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n\n")),(0,r.kt)("h2",{id:"a\xf0-sm\xed\xf0a-\xfeinn-egin-g\xe1m"},"A\xf0 sm\xed\xf0a \xfeinn egin g\xe1m"),(0,r.kt)("p",null,"\xcd \xfeessum hluta munum vi\xf0 fara yfir hvernig \xfe\xfa getur sm\xed\xf0a\xf0 gl\xe6n\xfdjan s\xe9rsni\xf0inn g\xe1m."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"A\xf0 byggja g\xe1ma krefst ",(0,r.kt)("strong",{parentName:"p"},"sudo")," r\xe9ttinda og \xfev\xed er ekki h\xe6gt a\xf0 keyra \xfea\xf0 \xe1 ",(0,r.kt)("strong",{parentName:"p"},"Elja"),".\nM\xe6lt er me\xf0 \xfev\xed a\xf0 sm\xed\xf0a g\xe1mana \xe1 einkav\xe9linni \xfeinni og afrita \xfe\xe1 yfir \xe1 ",(0,r.kt)("strong",{parentName:"p"},"Elja"))),(0,r.kt)("p",null,"Til a\xf0 b\xfaa til Singularity g\xe1m ver\xf0ur \xfe\xfa fyrst a\xf0 hla\xf0\xe1 ni\xf0\xfar ",(0,r.kt)("strong",{parentName:"p"},"Singularity")," \xe1 \xfe\xedna v\xe9l \xfe\xe1r sem sumar skipanir krefjast ",(0,r.kt)("strong",{parentName:"p"},"sudo")," r\xe9ttinda, og nota s\xed\xf0an build skipuninna til a\xf0 gera g\xe1min me\xf0f\xe6rilegan.\n",(0,r.kt)("strong",{parentName:"p"},"Singularity")," er \xed bo\xf0\xed fyrir Windows, MacOS og Linux, frekari uppl\xfdsingar er a\xf0 finna ",(0,r.kt)("a",{parentName:"p",href:"https://docs.sylabs.io/guides/3.0/user-guide/installation.html"},"h\xe9r"),"."),(0,r.kt)("p",null,"Vi\xf0 byrjum \xe1 \xfev\xed a\xf0 b\xfaa til skrifanlegan g\xe1m, einnig \xfeekktur sem sandkassi. Vi\xf0 munu nota ",(0,r.kt)("strong",{parentName:"p"},"shell")," skipunina me\xf0 valm\xf6guleikanum ",(0,r.kt)("inlineCode",{parentName:"p"},"-writable")," og gagnvirkt fikta vi\xf0 g\xe1min.\nVi\xf0 munum s\xed\xf0an b\xe6ta vi\xf0 breytingunum okkar vi\xf0 skilgreiningar skr\xe1 (",(0,r.kt)("em",{parentName:"p"},".def"),") og nota hana til a\xf0 endurbyggja g\xe1min."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ mkdir lolcow\n$ cd lolcow\n$ touch lolcow.def\n$ vim lolcow.def\n")),(0,r.kt)("p",null,"Skilgreiningar skr\xe1inn (",(0,r.kt)("em",{parentName:"p"},".def"),") mun innihalda eftirfarandi l\xednur:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'BootStrap: debootstrap\nOSVersion: stable\nMirrorURL: http://ftp.us.debian.org/debian/\n\n%runscript\n    echo "This is what happens when you run the container..."\n\n%post\n    echo "Hello from inside the container"\n    apt-get -y --allow-unauthenticated install vim\n')),(0,r.kt)("p",null,"Me\xf0 \xfeessari skilgreiningar skr\xe1 sem byrjunarp\xfankt getum vi\xf0 byrja\xf0 a\xf0 byggja okkar lolcow.img g\xe1m. ",(0,r.kt)("inlineCode",{parentName:"p"},"build")," skipuninn \xfearfnast ",(0,r.kt)("strong",{parentName:"p"},"sudo")," r\xe9ttinda!"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ sudo singularity build --sandbox lolcow lolcow.def\n")),(0,r.kt)("p",null,"Singularity mun sm\xed\xf0a g\xe1m a\xf0 nafni ",(0,r.kt)("em",{parentName:"p"},"lolcow")," me\xf0 ",(0,r.kt)("em",{parentName:"p"},"lolcow.def")," skilgreiningarskr\xe1nni. Valm\xf6guleikinn ",(0,r.kt)("inlineCode",{parentName:"p"},"--sandbox")," segir Singularity a\xf0 vi\xf0 viljum byggja s\xe9rstaka t\xfdpu af g\xe1m, sandkassa, \xed \xfer\xf3unarskyni."),(0,r.kt)("p",null,"N\xe6st munum vi\xf0 nota ",(0,r.kt)("inlineCode",{parentName:"p"},"shell --writable")," valm\xf6guleikan til a\xf0 gera breytingar \xe1 g\xe1mnum okkar."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ sudo singularity shell --writable lolcow\n")),(0,r.kt)("p",null,"Valm\xf6guleikin ",(0,r.kt)("inlineCode",{parentName:"p"},"--writable")," gerir okkur kleift a\xf0 gera breytingar \xe1 g\xe1mnum. \xdeessar breytingar ver\xf0a vista\xf0ar innan g\xe1msins og munu haldast \xf3br\xe9ttar milli notkunar."),(0,r.kt)("p",null,"N\xfa skulum vi\xf0 setja upp hugb\xfana\xf0 innan g\xe1msins."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Singularity> apt-get update\n\nSingularity> apt-get install -y fortune cowsay lolcat\n")),(0,r.kt)("p",null,"N\xe6st skulum vi\xf0 sj\xe1 hvort vi\xf0 getum keyrt \xfeennan hugb\xfana\xf0."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Singularity> fortune | cowsay | lolcat\nbash: lolcat: command not found\nbash: cowsay: command not found\nbash: fortune: command not found\n")),(0,r.kt)("p",null,"Vi\xf0 sj\xe1um a\xf0 ekkert af \xfeessum forritum er \xed ",(0,r.kt)("inlineCode",{parentName:"p"},"$PATH")," vi\xf0 getum nota\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"find")," til \xfeess a\xf0 finna hvar \xfeessi forrit eru geymd og b\xe6ta \xfeeirri m\xf6ppu \xed ",(0,r.kt)("inlineCode",{parentName:"p"},"$PATH"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"Singularity> find /usr -name cowsay\n/usr/games/cowsay\n\nSingularity> export PATH=$PATH:/usr/games\nSingularity> fortune | cowsay | lolcat\n _______________________________\n< Be careful! Is it classified? >\n -------------------------------\n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n")),(0,r.kt)("p",null,"Athugi\xf0: Ef \xfei\xf0 f\xe1i\xf0 vi\xf0varanir fr\xe1 Perl um a\xf0 'locale' s\xe9 rangur getur\xf0u laga\xf0 \xfea\xf0 me\xf0 : ",(0,r.kt)("inlineCode",{parentName:"p"},"export LC_ALL=C"),"."),(0,r.kt)("p",null,"N\xfa getum vi\xf0 smi\xf0a\xf0 loka SIF skr\xe1na. Til a\xf0 kemba (e. debug) getum vi\xf0 nota\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"shell")," til a\xf0 keyra Singularity g\xe1minn gagnvirkt, en til \xfeess a\xf0 gera breytingar \xe1 g\xe1mnum er m\xe6lt me\xf0 a\xf0 hafa \xfe\xe6r allar \xed skilgreiningar skranni \xfeinni. M\xe9\xf0 \xfev\xed a\xf0 halda breytingunum \xed skilgreiningarskr\xe1nni ver\xf0ur g\xe1murinn endurn\xfdtanlegur.  "),(0,r.kt)("p",null,"Uppf\xe6rum n\xfa skilgreiningarskr\xe1na me\xf0 \xfeeim breytingum sem vi\xf0 h\xf6fum gert."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ vim lolcow.def\n")),(0,r.kt)("p",null,"Svona l\xedtur uppf\xe6r\xf0a skilgreiningarskr\xe1in \xfat:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"BootStrap: debootstrap\nOSVersion: stable\nMirrorURL: http://ftp.us.debian.org/debian/\n\n%runscript\n    fortune | cowsay | lolcat\n\n%post\n    apt-get update\n    apt-get -y install fortune cowsay lolcat\n\n%environment\n    export LC_ALL=C\n    export PATH=$PATH:/usr/games\n")),(0,r.kt)("p",null,"N\xfa getum vi\xf0 endurbyggt g\xe1min me\xf0 skilgreiningarskr\xe1nni."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ sudo singularity build lolcow.sif lolcow.def\n")),(0,r.kt)("p",null,"Taki\xf0 eftir a\xf0 vi\xf0 h\xf6fum fjarl\xe6gt ",(0,r.kt)("inlineCode",{parentName:"p"},"--sandbox")," valm\xf6guleikan og b\xe6tt ",(0,r.kt)("em",{parentName:"p"},".sif")," framlenginguni \xe1 skr\xe1na. SIF skr\xe1 er \xfej\xf6ppu\xf0 og \xf3breytileg sem gerir \xfea\xf0 a\xf0 g\xf3\xf0um valkost fyrir umhverfi til \xfatg\xe1fu. "),(0,r.kt)("p",null,"N\xfa \xe6ttum vi\xf0 a\xf0 geta keyrt \xfatg\xe1fu g\xe1minn okkar."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ singularity run lolcow.sif\n ______________________________________ \n/ A robin redbreast in a cage Puts all \\\n| Heaven in a rage.                    |\n|                                      |\n\\ -- Blake                             /\n -------------------------------------- \n        \\   ^__^\n         \\  (oo)\\_______\n            (__)\\       )\\/\\\n                ||----w |\n                ||     ||\n")),(0,r.kt)("h4",{id:"f\xe6ra-g\xe1m-yfir-\xe1-elju"},"F\xe6ra g\xe1m yfir \xe1 Elju"),(0,r.kt)("p",null,"N\xfa \xfeegar vi\xf0 erum b\xfain sm\xed\xf0a g\xe1min og viljum keyra hann \xe1 HPC \xfeyrpinguni. Til \xfeess a\xf0 gera \xfea\xf0 \xfeurfum vi\xf0 a\xf0 nota ",(0,r.kt)("inlineCode",{parentName:"p"},"scp")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ scp -i ~/.ssh/<Your private SSH key> /path/to/containers/lolcow.sif <username>@elja.hi.is:~/containers     \n")),(0,r.kt)("p",null,"G\xe1murinn ver\xf0ur n\xfa fluttur yfir \xe1 ",(0,r.kt)("strong",{parentName:"p"},"Elju")," og ver\xf0\xfar a\xf0gengilegur \xe1 heimasv\xe6\xf0inu \xfeinu. N\xfa \xe6ttir \xfe\xfa a\xf0 geta keyrt g\xe1minn \xe1 reiknihn\xfatum me\xf0 hj\xe1lp ",(0,r.kt)("strong",{parentName:"p"},"SLURM")),(0,r.kt)("h2",{id:"keyra-singularity-me\xf0-slurm"},"Keyra Singularity me\xf0 SLURM"),(0,r.kt)("h3",{id:"gpu-d\xe6mi"},"GPU D\xe6mi"),(0,r.kt)("p",null,"Fyrst \xfeurfum vi\xf0 a\xf0 hefja gagnvirka keyrslu og s\xed\xf0an getum vi\xf0 hla\xf0i\xf0 ni\xf0ur \xfeeim Singularity myndum sem okkur hentar. \xcd \xfeessu d\xe6mi er \xfea\xf0 hello-world.sif:\n",(0,r.kt)("a",{parentName:"p",href:"/docs/elja/interactive_session"},"Hvernig \xe1 \xe1\xf0 hefja gagnvirkar keyrslur")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'$ srun --job-name "InteractiveGPU" --partition gpu-1xA100 --time 0-01:00 --pty bash\n$ singularity pull --name lolcow.sif library://sylabsed/examples/lolcow_latest\n')),(0,r.kt)("p",null,"Til a\xf0 f\xe1 a\xf0gengi a\xf0 Nvidia GPU driflinum innan Singularity g\xe1msins \xfeurfum vi\xf0 a\xf0 nota valm\xf6guleikan ",(0,r.kt)("inlineCode",{parentName:"p"},"--nv")," \xfeegar vi\xf0 keyrum g\xe1minn. Til a\xf0 sta\xf0fetsa a\xf0 \xfe\xfa hafur a\xf0gengi a\xf0 umbe\xf0num skj\xe1kortum getur \xfe\xfa keyrt ",(0,r.kt)("inlineCode",{parentName:"p"},"nvidia-smi")," innan g\xe1msins:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ singularity exec --nv lolcow.sif /bin/bash\nSingularity> nvidia-smi\n +-----------------------------------------------------------------------------+\n| NVIDIA-SMI x96.26 Driver Version: 396.26 |\n|-------------------------------+----------------------+----------------------+\n| GPU Name Persistence-M| Bus-Id Disp.A | Volatile Uncorr. ECC |\n| Fan Temp Perf Pwr:Usage/Cap| Memory-Usage | GPU-Util Compute M. |\n|===============================+======================+======================|\n| 0 Tesla K20Xm Off | 00000000:88:00.0 Off | 0 |\n| N/A 37C P0 61W / 235W | 0MiB / 5700MiB | 65% Default |\n+-------------------------------+----------------------+----------------------+\n")),(0,r.kt)("h3",{id:"singularity-g\xe1mar-og-slurm-verkefni"},"Singularity g\xe1mar og SLURM verkefni"),(0,r.kt)("p",null,"\xde\xfa getur nota\xf0 Singularity myndir sem \xf3gagnvirkar lotu skriftur eins og hver \xf6nnur skipun. Ef g\xe1murinn inniheldir keyrslu-skriftu \xfe\xe1 getur \xfe\xfa nota\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"singularity run"),"\ntil a\xf0 keyra Singularity keyrslu-skriftuna \xed lotuni. \xde\xfa getur einnig nota\xf0 Singularity exec til a\xf0 keyra handah\xf3fskenndar skipanir (e\xf0a skriftur) innan g\xe1msins. "),(0,r.kt)("p",null,"D\xe6mi:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"#!/bin/bash\n#SBATCH -J singularity_job\n#SBATCH --mail-type=ALL\n#SBATCH --mail-user=<Your E-mail> # for example uname@hi.is\n#SBATCH --partition=48cpu_192mem  # request node from a specific partition\n#SBATCH --nodes=2                 # number of nodes\n#SBATCH --ntasks-per-node=48      # 48 cores per node (96 in total)\n#SBATCH --mem-per-cpu=3900        # MB RAM per cpu core\n#SBATCH --time=0-04:00:00         # run for 4 hours maximum (DD-HH:MM:SS)\n#SBATCH --hint=nomultithread      # Suppress multithread\n#SBATCH --output=slurm_job_output.log   \n#SBATCH --error=slurm_job_errors.log   # Logs if job crashes\n\n# Singularity command line options\nsingularity pull library://sylabsed/examples/lolcow:latest\nsingularity run lolcow_latest.sif\n")),(0,r.kt)("p",null,"Ef lotu-skriftan h\xe9r a\xf0 ofan er nefnd ",(0,r.kt)("inlineCode",{parentName:"p"},"singularity_job.sbatch"),", sem d\xe6mi, er h\xe6gt a\xf0 leggja fram lotu-keyrsluna eins og vanalega me\xf0 ",(0,r.kt)("inlineCode",{parentName:"p"},"sbatch"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ sbatch singularity_job.sbatch\n")))}p.isMDXComponent=!0}}]);